rootProject.name = 'tutteli-gradle'


buildscript {
    gradle.ext.version = '0.2.0'
    gradle.ext.repo = "${rootProject.projectDir}/repo"

    apply from: "${rootProject.projectDir}/gradle/scripts/localRepo.gradle"
    includeLocalRepo(gradle.ext.repo, 'settings', gradle.ext.version, this)
}

if (!ext.localPluginExists) {
    buildscript {
        repositories {
            maven {
                url "https://plugins.gradle.org/m2/"
            }
        }
        dependencies {
            classpath "ch.tutteli:tutteli-gradle-settings:0.2.0"
        }
    }
}

//TODO remove as soon as 0.2.0 is published
def includeTopLevel(String name) { includeInSubFolder(name, "/") }
def includeInSubFolder(String nameWithoutPrefix, String folder) {
    def name = "${rootProject.name}-$nameWithoutPrefix"
    include ":$name"
    project(":$name").projectDir = new File("${rootProject.projectDir}/$folder/$name")
}

def error = false

//TODO remove `if` as soon as 0.2.0 is published
if (ext.localPluginExists && !error) {
    apply plugin: 'ch.tutteli.settings'
}

//TODO enable as soon as 0.2.0 is publsihed
if (ext.localPluginExists && !error) {
    /**
     * Shortcut for `include "${rootProject.name}-settings"; include "${rootProject.name}-jacoco"`
     */
    includePrefixed ('settings', 'junitjacoco')
} else {
    includeTopLevel 'settings'
    includeTopLevel 'junitjacoco'
}

/**
 * Shortcut for `include ":${rootProject.name}-name"`
 * and it sets `project.projectDir` accordingly (to "${rootProject.projectDir}/folder/${rootProject.name}-name")
 */
//includePrefixedInFolder('folder', 'name')

/**
 * Does not use naming convention.
 * Shortcut for `include ":$name"`
 * and it sets `project.projectDir` accordingly (to "${rootProject.projectDir}/folder/name")
 */
//includeCustomInFolder('folder', 'name')

/**
 * Or you can use the extension object `include`
 *
 * include {
 *     //same as includePrefixed
 *     prefixed 'one module'
 *     prefixed ('or', 'several', 'modules')
 *
 *     folder ('test') {
 *          //same as includePrefixedInFolder
 *          prefixed 'in-folder'
 *
 *          //same as includeCustomInFolder
 *          project 'without-prefix'
 *          project ('also', 'multiple', 'without', 'prefix', 'is', 'possible')
 *     }
 *
 *     //same as a normal `include` -- or in other words, not prefixed with `rootProject.name`
 *     project 'toplevel'
 * }
 *
 */
